<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Lab Test Tree View -->
    <record id="view_clinic_lab_test_tree" model="ir.ui.view">
        <field name="name">clinic.lab.test.tree</field>
        <field name="model">clinic.lab.test</field>
        <field name="arch" type="xml">
            <tree string="Lab Tests" decoration-danger="priority=='emergency'" decoration-warning="priority=='urgent'" decoration-info="state=='draft'" decoration-success="state=='completed'">
                <field name="test_number"/>
                <field name="patient_id"/>
                <field name="test_type"/>
                <field name="test_name"/>
                <field name="test_date"/>
                <field name="result_date"/>
                <field name="test_cost" widget="monetary"/>
                <field name="priority" widget="badge"/>
                <field name="state" widget="badge"/>
            </tree>
        </field>
    </record>

    <!-- Lab Test Form View -->
    <record id="view_clinic_lab_test_form" model="ir.ui.view">
        <field name="name">clinic.lab.test.form</field>
        <field name="model">clinic.lab.test</field>
        <field name="arch" type="xml">
            <form string="Lab Test">
                <header>
                    <button name="action_collect_sample" string="Collect Sample" type="object" class="oe_highlight"/>
                    <button name="action_start_test" string="Start Test" type="object" class="oe_highlight"/>
                    <button name="action_complete" string="Complete" type="object" class="oe_highlight"/>
                    <button name="action_cancel" string="Cancel" type="object"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,sample_collected,in_progress,completed"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1><field name="test_number" readonly="1"/></h1>
                    </div>

                    <group>
                        <group string="Patient Information">
                            <field name="patient_id" options="{'no_create': True}"/>
                            <field name="doctor_id"/>
                            <field name="appointment_id"/>
                        </group>
                        <group string="Priority  Status">
                            <field name="priority" widget="radio"/>
                            <field name="technician_id"/>
                        </group>
                    </group>

                    <group>
                        <group string="Test Information">
                            <field name="test_type"/>
                            <field name="test_name"/>
                            <field name="test_description" placeholder="Test description..."/>
                            <field name="test_cost"/>
                        </group>
                        <group string="Dates">
                            <field name="test_date"/>
                            <field name="result_date"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Test Results">
                            <group>
                                <group>
                                    <field name="normal_range" placeholder="e.g., 70-100 mg/dL"/>
                                    <field name="test_value"/>
                                    <field name="unit" placeholder="e.g., mg/dL"/>
                                </group>
                            </group>
                            <group string="Detailed Result">
                                <field name="result" placeholder="Detailed test result and interpretation..."/>
                            </group>
                            <group string="Attachment">
                                <field name="result_file" filename="result_filename"/>
                                <field name="result_filename" invisible="1"/>
                            </group>
                        </page>

                        <page string="Notes">
                            <field name="notes" placeholder="Additional notes about the test..."/>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Lab Test Kanban View -->
    <record id="view_clinic_lab_test_kanban" model="ir.ui.view">
        <field name="name">clinic.lab.test.kanban</field>
        <field name="model">clinic.lab.test</field>
        <field name="arch" type="xml">
            <kanban default_group_by="state">
                <field name="test_number"/>
                <field name="patient_id"/>
                <field name="test_name"/>
                <field name="test_date"/>
                <field name="priority"/>
                <field name="state"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="o_kanban_record_top">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <field name="test_number"/>
                                    </strong>
                                    <div class="o_kanban_record_subtitle">
                                        <field name="patient_id"/>
                                    </div>
                                </div>
                                <span class="float-end badge" t-if="record.priority.raw_value == 'emergency'" style="background-color: #dc3545;">EMERGENCY</span>
                                <span class="float-end badge" t-if="record.priority.raw_value == 'urgent'" style="background-color: #ffc107;">URGENT</span>
                            </div>
                            <div class="o_kanban_record_body">
                                <field name="test_name"/>
                                <div class="text-muted">
                                    <i class="fa fa-calendar"/> <field name="test_date"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Lab Test Search View -->
    <record id="view_clinic_lab_test_search" model="ir.ui.view">
        <field name="name">clinic.lab.test.search</field>
        <field name="model">clinic.lab.test</field>
        <field name="arch" type="xml">
            <search string="Search Lab Tests">
                <field name="test_number"/>
                <field name="patient_id"/>
                <field name="test_name"/>
                <filter string="Today" name="today" domain="[('test_date', '=', context_today().strftime('%Y-%m-%d'))]"/>
                <filter string="This Week" name="this_week" domain="[('test_date', '&gt;=', (context_today() - datetime.timedelta(days=context_today().weekday())).strftime('%Y-%m-%d'))]"/>
                <separator/>
                <filter string="Draft" name="draft" domain="[('state', '=', 'draft')]"/>
                <filter string="Sample Collected" name="sample_collected" domain="[('state', '=', 'sample_collected')]"/>
                <filter string="In Progress" name="in_progress" domain="[('state', '=', 'in_progress')]"/>
                <filter string="Completed" name="completed" domain="[('state', '=', 'completed')]"/>
                <separator/>
                <filter string="Emergency" name="emergency" domain="[('priority', '=', 'emergency')]"/>
                <filter string="Urgent" name="urgent" domain="[('priority', '=', 'urgent')]"/>
                <group expand="0" string="Group By">
                    <filter string="Test Type" name="test_type_group" context="{'group_by': 'test_type'}"/>
                    <filter string="Patient" name="patient_group" context="{'group_by': 'patient_id'}"/>
                    <filter string="Date" name="date_group" context="{'group_by': 'test_date'}"/>
                    <filter string="Status" name="state_group" context="{'group_by': 'state'}"/>
                    <filter string="Priority" name="priority_group" context="{'group_by': 'priority'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Lab Test Action -->
    <record id="action_clinic_lab_test" model="ir.actions.act_window">
        <field name="name">Lab Tests</field>
        <field name="res_model">clinic.lab.test</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">{'search_default_today': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a new lab test
            </p>
            <p>
                Click the create button to add a new lab test request.
            </p>
        </field>
    </record>
            <menuitem id="menu_lab_root" name="labs Report" parent="menu_clinic_management" sequence="2" action="action_clinic_lab_test"/>

</odoo>